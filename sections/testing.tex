\documentclass[../main.tex]{subfiles}
\graphicspath{{\subfix{../images/}}}

\begin{document}

\begin{newrequirements}
    \textbf{Note that this section is a substantial 
    portion of the grade for your final 
    report and will require a significant 
    amount of effort.}

    \begin{todolist}
    \item describe in detail the tests you have 
        conducted to verify that your prototype 
        satisfies the desired functional 
        requirements while meeting the design 
        constraints. For example, if you used 
        Use Cases to describe your non-
        functional requirements, then for each 
        use case you should write a test case, 
        run it and report the testing results
        (the key test cases can be added as an 
        Appendix). Functional testing will 
        allow you to find defects then fix them 
        and also identify possible 
        improvements.  You need to have a 
        comprehensive set of tests that 
        verifies correct functionality of every 
        component of your system. 

    \item verify and provide evidence through 
        testing that your solution solved the 
        stated problem and satisfied the 
        requirement specifications and design 
        constraints, documented in Section 3.2 
        of the interim report. If not, explain 
        what is lacking and identify possible 
        improvements 

    \item This section must present sufficient 
        evidence and clear discussion that your 
        design and prototype met/did-not-meet 
        all of the identified technical and 
        practical constraints documented in 
        Section 3.2. You may use a summary 
        table to elaborate these points. The 
        table columns could contain: 

    \begin{todolist}
    \item Brief description of the constraints 

    \item Explanation of the testing steps taken 
        to evaluate if the constraint was met 
        or not. 

    \item Measurements data that prove your 
        system met/did-not-meet the constraint. 
        Also compare measured data against 
        expected values, then include a \%error 
        as (actual – expected)/expected*100\%, 
        and use only three digits of precision. 
        In case a constraint is not met, then 
        explain the reason for that. 
    \end{todolist}

    \item For further details and examples refer 
        to the document titled ‘Examples of how 
        to address and verify some of the 
        design constraints’ posted on the 
        Senior Projects website. 
         
    \item Describe in detail the tests performed 
        on the individual subsystems of your 
        project.  Discuss how you tested each 
        subsystem and what the results of each 
        test were. 

    \item In addition, do not forget to include: 

    \begin{todolist}
    \item If you have a GUI of some type, you 
        need a screen shot of it. 

    \item If you have a physical display of some 
        type (LEDs, LCDs, etc.), you need a 
        photograph of the display showing 
        typical operation. 

    \item For any interfaces of your hardware 
        components – USB, I2C, SPI, RS232, 
        parallel interfaces, or A/D inputs – 
        you may show oscilloscope pictures that 
        demonstrate a sample data transfer of 
        this interface and the typical 
        voltage/frequency ranges. 
    \end{todolist}

    \item You should present the test results, 
        with appropriate level of details in 
        addition to accuracy and completeness, 
        using tables, graphs, diagrams, screen 
        shots etc. Additionally, discuss these 
        results and explain whether the 
        prototype has achieved the 
        requirements. If not state what is 
        lacking or still need improvement then 
        explain the reason for that. There will 
        probably be multiple subsections under 
        this section to describe each system 
        test and its result. 

    \end{todolist}
\end{newrequirements}

\begin{table}[H]
    \centering
    \caption{Summary of the prototype testing}
    \label{tab:testing-summary}
    \begin{tabularx}{\textwidth}{ l X l l l }
        \toprule
        \textit{Constraint} 
            & \textit{Testing procedure} 
                & \textit{Result}
        & \textit{Measurement data} 
            & \textit{Error (\%)} \\

        \midrule
        
        
        ??    & ?? 
        & Met
            & ??
        & 5 \\

        \bottomrule		
    \end{tabularx}
\end{table}

%% Each subsection corresponds to a test.
%% Title the subsection based on the functional requirement OR
%% the design constraint being tested.

% HARDWARE
\subsection{Connecting to the drone}

We have connected the
Raspberry Pi to the drone using built-in WiFi
to allow Raspberry to send/receive control and status 
instructions to the drone. 
For connecting Raspberry Pi and the laptop, 
we used the external WiFi adapter and turned 
on the hotspot feature to create an access point,
and this made the process so convenient because 
once the Raspberry Pi boots up, it turns on the 
access point, and the user can connect to it 
easily and execute scripts using \textsc{ssh} 
protocol or open the web app user interface 
at www.aireye.com:8000. We executed the takeoff 
and move forward scripts and it worked successfully, so
we confirm that we can connect to the drone and can control it.

\subsection{Command-Control system maximum distance}



\subsection{Flying duration \& Batteries}

As shown in Fig.~\ref{fig:time-comparison} we have 
conducted time comparison experiments for both drone 
battery (2700mAh) and raspberry pi battery (4000mAh) 
using different actions such as idle, hovering, 
moving forward, and moving backward. We repeated 
the same actions without video streaming so that 
we can see its effect on the power consumption. 
All the batteries were charged fully and the timer 
script stops when the battery percent reaches zero. 

First, we will discuss idle action, and as normal 
the maximum time reached is when both drone and 
raspberry pi are in an idle state, which both will 
be on the ground without moving any motors, 
this action still consumes energy but with 
its stability, over time ~\cite{Abey18}. 
The next action is when the drone is hovering and 
the raspberry pi is sending navigation control 
signals to the drone and receiving video frames 
that are streamed to a web graphical interface. 
When the drone hovers without streaming it worked 
for 14.78 minutes, and when the camera is used for 
the stream which will add more power consumption to 
the drone battery, it worked for 14.2 minutes which 
is less than the hovering without steam. The final 
action is when the drone takeoff and keep moving 
forward, backward, left, and right, in this action 
more energy consumption is seen and that made the 
battery for the drone survives only for 13.58 minutes 
when the camera is off, and for 13.18 minutes 
when the camera and stream are on.

The main focus will be on the drone battery and every 
action energy this is because the raspberry pi battery 
is not being highly affected by the actions. 
The next step is to derive the energy model for every 
action by using the distance and time. For the drone battery, 
we have 2700mAh which is 20.52Wh ~\cite{Par19}, 
we can get the drone energy by multiplying Wh by 3600 
so we will have a total of 73,872 Joules. let's take 
hovering without stream as an example, the battery 
went from 100 percent to 0 in 14.78 minutes which is 
886.8 seconds. we can say that the hovering action takes approximately 73,872/886.8 = 83.30 Joules/sec. For moving action 
we will consider the distance also, so we will keep 
moving the drone one meter in each direction 
{forward, backward, left, right} and then calculate 
the total distance that traveled. The drone repeated 
the moving action 11 times, so the total distance 
is 44 meters and the energy per second consumed 
is 73,872/814.8 = 90.66 Joules/sec but this energy 
per second is for the 44 meters, we can get the 
energy per second for 1 meter by calculating 
90.66/44 = 2.06 Joules/s. 
In (\ref{eq:Energy-moving}) we can generalize an energy equation for moving action, which can be used in the simulation environment to train the RL model, now it will not just consider the time, but also the energy consumption.
Now we verified the flight duration constrain and we can to devise some 
realistic energy models, that can be fed in the simulation to do the comparisons. This will help the RL model to choose 
the best action depending on less energy consumption 
when both actions have the same probability. 

\begin{align}
	P = \frac{E(J)}{t(s)} 
	\label{eq:power}
\end{align}

\begin{align}
	E = 2.06t*d
	\label{eq:Energy-moving}
\end{align}

\begin{figure}[!t]
	\centering
	\includegraphics[width=5in]{battries-time}
	\caption{Battery's lifetime comparison.}
	\label{fig:time-comparison}
\end{figure}

\subsection{Response time}

We have done another experiment regarding the response time 
of the drone after sending a command to it from the Raspberry Pi. 
Calculating the response time was by starting a timer when 
sending the command and stopping it when the 
state of the drone changes. 
The experiment was done on simulation using Sphinx,
then we have moved to the real world using the \anafi drone.
From \cref{tab:respone-time}, 
we can see that all the results are less than \SI{1}{second}
which satisfied our response time constraint.
Another thing we can conclude from the table is that 
the response time of the real world is less than 
the simulation, and this is predictable since the simulation
depends on the \textsc{gpu} power and processing time. 

\begin{table}[tbp]
	\centering
	\caption{The average response time of the drone after sending a control command.}
	\label{tab:respone-time}
	\begin{tabularx}{0.7\textwidth}{ X c c }
		\toprule
		\textit{} & \textit{Simulation} & \textit{Real-world}\\ \midrule
		Motor ramping for takeoff (seconds)  & 0.3506 & 0.0323     \\
		Move while flying (seconds) & 0.7441  & 0.1511   \\
		\bottomrule
	\end{tabularx}
\end{table} 

\subsection{Payload}

As shown in \cref{fig:payload}
we attached \SI{190}{grams} of Raspberry Pi and Arduino boards
to see the effect on the performance and flight and
battery drain percentage. 
The drone has taken off  successfully, 
and the flight was normal but, we faced an expected 
battery drain that went from 
\SI{100}{\percent} to \SI{90}{\percent} in 
\SI{1.5}{minutes}.This is because the propeller motors will try to push 
their limits to take off the drone, which will consume more energy.
After adding payload to the drone at \SI{200}{grams}, the drone couldn't
takeoff and we now know the payload limit, which will be considered in the 
design constraints.

\begin{figure}[bp]
	\centering
	\includegraphics[width=0.6\textwidth]{payload.png}
	\caption{The total weight of test payload}
	\label{fig:payload}
\end{figure} 



% SOFTWARE
\subsection{Simulating the targets}

\lipsum[1]

\subsection{RL training}

\lipsum[1]

\subsection{RL model performance}

\lipsum[1]

\subsection{User interface}

\lipsum[1]


\end{document}
